{% include "user/header.html" %}
{% load static %}

<!-- Single Page Header start -->
<div class="container-fluid page-header py-5">
  <h1 class="text-center text-white display-6">Shop</h1>
  <ol class="breadcrumb justify-content-center mb-0">
    <li class="breadcrumb-item"><a href="/">Home</a></li>
    <li class="breadcrumb-item active text-white">Shop</li>
  </ol>
</div>
<!-- Single Page Header End -->

<!-- Fruits Shop Start-->
<div class="container-fluid fruite py-5">
  <div class="container py-5">
    <h1 class="mb-4">Fresh fruits shop</h1>

    <!-- Search form -->
    <div class="row g-4">
      <form method="get" action="/shop/">
        <div class="col-xl-3">
          <div class="input-group w-100 mx-auto d-flex">
            {% csrf_token %}
            <input
              type="search"
              class="form-control p-3"
              placeholder="keywords"
              aria-describedby="search-icon-1"
              name="search"
            />
            <span id="search-icon-1" class="input-group-text p-3">
              <i class="fa fa-search"></i>
            </span>
          </div>
        </div>
      </form>

        <div class="col-xl-3 offset-md-9">
          <div class="bg-light ps-3 py-3 rounded d-flex justify-content-between mb-4">
            <label for="fruits">Default Sorting:</label>
            <form id="filterForm" method="get" action="{% url 'shop' %}">
              <select
                id="fruits"
                name="sort_by_price"
                class="border-0 form-select-sm bg-light me-3"
                form="fruitform"
              >
                <option value="">Sắp xếp theo giá</option>
                <option value="ascending">Giá thấp đến cao</option>
                <option value="descending">Giá cao đến thấp</option>
              </select>
            </form>
          </div>
        </div>
      </div>

    <!-- Categories -->
    <div class="row g-4">
      <div class="col-lg-3">
        <div class="row g-4">
          <div class="col-lg-12">
            <div class="mb-3">
              <h4>Categories</h4>
              <ul class="list-unstyled fruite-categorie">
                {% for category in categories %}
                <li>
                  <div class="d-flex justify-content-between fruite-name">
                    <a href="?category={{ category.madanhmuc }}">{{ category.tendanhmuc }}</a>
                    <span>({{category.num_products}})</span>
                  </div>
                </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Products -->
      <div class="col-lg-9">
        <div class="row g-4 justify-content-last m-auto">
          {% for nongsan in result %}
          <div class="col-md-6 col-lg-6 col-xl-4">
            <div class="rounded position-relative fruite-item">
              <div class="fruite-img">
                <img src="{{ nongsan.image.url }}" class="img-fluid w-100 rounded-top" alt="" />
              </div>
              <div class="text-white bg-secondary px-3 py-1 rounded position-absolute" style="top: 10px; left: 10px">
                {% for category in categories %}
                {% if nongsan.madanhmuc.madanhmuc == category.madanhmuc %}
                {{ category.tendanhmuc }}
                {% endif %}
                {% endfor %}
              </div>
              <div class="p-4 border border-secondary border-top-0 rounded-bottom">
                <h4>{{ nongsan.ten }}</h4>
                <p>
                  {{nongsan.mota}}
                </p>
                <div class="d-flex justify-content-between flex-lg-wrap">
                  <p class="text-dark fs-5 fw-bold mb-0">{{nongsan.gia|floatformat:0 }} / kg</p>
                  <a href="{% url 'add_to_cart' nongsan.idnongsan %}" class="btn border border-secondary rounded-pill px-3 text-primary">
                    <i class="fa fa-shopping-bag me-2 text-primary"></i>
                    Add to cart
                  </a>
                </div>
              </div>
            </div>
          </div>
          {% empty %}
          {% if query %}
          <p>No products found for "{{ query }}".</p>
          {% else %}
          <p>No products found.</p>
          {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Fruits Shop End-->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const selectBox = document.getElementById('fruits');
    
    selectBox.addEventListener('change', function() {
      const selectedValue = this.value;
      
      // Update form action if needed
      document.getElementById('filterForm').setAttribute('action', '{% url "shop" %}?sort_by_price=' + selectedValue);
      
      // Submit the form
      document.getElementById('filterForm').submit();
    });
  });
  </script>
{% include "user/footer.html" %}
